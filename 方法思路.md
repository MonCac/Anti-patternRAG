# æ–¹æ³•æ€è·¯

## ä¸€ã€RAG éƒ¨åˆ†

1. é¦–å…ˆç¼–å†™ä¸€ä¸ªragé›å½¢
2. å¯¹äºåˆ†å—ï¼Œè€ƒè™‘å•æ¡ˆä¾‹ä¸­çš„ä»£ç åˆ†å—ã€ç„¶åå¯¹äºåˆ†å¥½å—çš„å†…å®¹ï¼Œä½œä¸ºä¸€ä¸ªå¤§å—ã€‚æœ€åæ£€ç´¢æŒ‰ç…§å¤§å—æ¥è¾“å‡ºæ£€ç´¢å†…å®¹ã€‚ï¼ˆåªä½¿ç”¨ä¿®å¤å‰çš„æ¡ˆä¾‹ï¼‰
3. è€ƒè™‘åˆ†å®Œå—ä¹‹åå¦‚ä½•ä¸embeddingç»“åˆï¼Œå¹¶ä¸”å¯¹äºè¾“å‡ºçš„æ£€ç´¢å†…å®¹ä¹Ÿè¦è€ƒè™‘æ€ä¹ˆä½œä¸ºå¤§å—å»è¾“å‡ºembeddingä½œä¸ºä¸€ä¸ªæ•´ä½“ã€‚å­˜æ”¾åœ¨å‘é‡æ•°æ®åº“ä¸­
4. å¯¹æ–°çš„ä¿®å¤æ¡ˆä¾‹è¿›è¡Œåˆ†å—å’Œembeddingï¼Œå¾—åˆ°ç›¸ä¼¼çš„ç‰‡æ®µ
5. ç¼–å†™é‡æ’åºç®—æ³•æ¥å¾—åˆ°å®é™…ä¸Šæœ€ç›¸ä¼¼çš„ç‰‡æ®µ



### ç»“æ„åŒ– + åˆ†å— + åˆ†å±‚ç´¢å¼•çš„åæ¨¡å¼ RAG

```txt
[åæ¨¡å¼æ¡ˆä¾‹] â†’ [å­å—ä»¬] â†’ [ç»“æ„+è¯­ä¹‰å‘é‡] â†’ [å­å—æ£€ç´¢] â†’ [èšåˆçˆ¶æ¡ˆä¾‹] â†’ [æ„å»ºä¸Šä¸‹æ–‡] â†’ [LLM ç”Ÿæˆä¿®å¤å»ºè®®]
```

## äºŒã€LLM å¾®è°ƒéƒ¨åˆ†

é€šè¿‡å®Œæ•´çš„æ•°æ®é›†é¢„è®­ç»ƒå¤§æ¨¡å‹ï¼Œå®Œæˆå¾®è°ƒã€‚

ä¿è¯é¢„è®­ç»ƒæ—¶ä¸ragçš„promptç­‰ä¿¡æ¯ä¸€è‡´ï¼Œå®Œæˆæ¶æ„åæ¨¡å¼é‡æ„ä¸“ç”¨LLM







![image-20250713205054662](/Users/moncheri/Downloads/main/é‡æ„/fse/image-20250713205054662.png)



![image-20250713205109910](/Users/moncheri/Downloads/main/é‡æ„/fse/image-20250713205109910.png)



![image-20250713205233760](/Users/moncheri/Downloads/main/é‡æ„/fse/image-20250713205233760.png)

![image-20250713225853046](../fse/image-20250713225853046.png)











```bash
antipattern-rag/
â”œâ”€â”€ data/                          # âœ… å­˜æ”¾åŸå§‹æ•°æ®å’Œç»“æ„ä¿¡æ¯
â”‚   â”œâ”€â”€ raw/                       # åŸå§‹æ¡ˆä¾‹æ•°æ®ï¼ˆjsonã€ä»£ç ç­‰ï¼‰
â”‚   â”œâ”€â”€ processed/                 # åˆ†å—åçš„å­chunkå’Œå‘é‡ä¿¡æ¯
â”‚   â””â”€â”€ examples/                 # ç¤ºä¾‹æŸ¥è¯¢ / æ¡ˆä¾‹æµ‹è¯•é›†

â”œâ”€â”€ docs/                          # ğŸ“„ é¡¹ç›®æ–‡æ¡£ï¼ˆè¯´æ˜ã€è®¾è®¡å›¾ï¼‰
â”‚   â””â”€â”€ rag_pipeline.md           # æ•´ä½“æµç¨‹è¯´æ˜

â”œâ”€â”€ embeddings/                   # âœ… å‘é‡ç”Ÿæˆæ¨¡å—
â”‚   â”œâ”€â”€ code_embedding.py         # ç”¨CodeBERT/CodeT5ç”Ÿæˆè¯­ä¹‰å‘é‡
â”‚   â”œâ”€â”€ structure_features.py     # è‡ªå®šä¹‰ç»“æ„å‘é‡æå–é€»è¾‘
â”‚   â””â”€â”€ hybrid_embedder.py        # æ‹¼æ¥ç»“æ„+è¯­ä¹‰å‘é‡

â”œâ”€â”€ retriever/                    # âœ… è‡ªå®šä¹‰æ£€ç´¢é€»è¾‘
â”‚   â”œâ”€â”€ subchunk_retriever.py     # å­å—çº§æ£€ç´¢é€»è¾‘
â”‚   â”œâ”€â”€ parent_aggregator.py      # å­å—â†’çˆ¶å—èšåˆå™¨
â”‚   â””â”€â”€ reranker.py               # å¯é€‰ï¼šäºŒæ¬¡æ’åºé€»è¾‘

â”œâ”€â”€ splitter/                     # âœ… è‡ªå®šä¹‰åˆ†å—å™¨
â”‚   â”œâ”€â”€ case_splitter.py          # å°†æ¡ˆä¾‹æ‹†æˆç»“æ„æ„ŸçŸ¥å­å—
â”‚   â””â”€â”€ ast_utils.py              # AST è§£æå·¥å…·ï¼ˆå¦‚æå–å‡½æ•°ã€è°ƒç”¨é“¾ç­‰ï¼‰

â”œâ”€â”€ pipeline/                     # âœ… æµç¨‹æ§åˆ¶ï¼ˆå¯å¯¹æ¥ LangChainï¼‰
â”‚   â”œâ”€â”€ rag_chain.py              # ä¸» RAG ç»„åˆé€»è¾‘
â”‚   â”œâ”€â”€ retriever_wrapper.py      # ç»§æ‰¿ LangChain BaseRetriever
â”‚   â””â”€â”€ prompt_template.py        # LLM æç¤ºæ¨¡æ¿è®¾è®¡

â”œâ”€â”€ llm/                          # âœ… LLM æ¥å…¥ä¸è¾“å‡ºå¤„ç†
â”‚   â”œâ”€â”€ llm_provider.py           # æ¥ OpenAI / æœ¬åœ°æ¨¡å‹
â”‚   â””â”€â”€ fix_parser.py             # LLM è¾“å‡ºç»“æœç»“æ„åŒ–è§£æå™¨

â”œâ”€â”€ app/                          # âœ… ç”¨äºè°ƒç”¨çš„ä¸»ç¨‹åºï¼ˆCLI æˆ– APIï¼‰
â”‚   â”œâ”€â”€ main.py                   # CLI å¯åŠ¨å…¥å£
â”‚   â””â”€â”€ api.py                    # å¯é€‰ï¼šFastAPI / Gradio æ¥å£

â”œâ”€â”€ tests/                        # âœ… æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ test_splitter.py
â”‚   â”œâ”€â”€ test_retriever.py
â”‚   â””â”€â”€ test_chain.py

â”œâ”€â”€ config/                       # âœ… é…ç½®é¡¹
â”‚   â””â”€â”€ settings.yaml             # å‘é‡ç»´åº¦ã€è·¯å¾„ã€æ¨¡å‹é€‰æ‹©ç­‰

â”œâ”€â”€ requirements.txt              # Pythonä¾èµ–ï¼ˆLangChainã€transformersç­‰ï¼‰
â”œâ”€â”€ README.md                     # ä½¿ç”¨è¯´æ˜
â””â”€â”€ .env                          # OpenAI key æˆ–æœ¬åœ°æ¨¡å‹è·¯å¾„
```



```
pipeline/rag_chain.py â€” æ„å»ºæœ€åŸºæœ¬çš„ RAG Chain

app/main.py â€” CLI å¯åŠ¨å…¥å£ï¼Œè°ƒç”¨ RAG Chain

splitter/case_splitter.py â€” åŸºç¡€æ–‡æœ¬åˆ†å—å™¨ç¤ºä¾‹

embeddings/code_embedding.py â€” ç®€å•è°ƒç”¨ OpenAI Embeddingsï¼ˆç¤ºèŒƒï¼‰

retriever/retriever_wrapper.py â€” ç»§æ‰¿ LangChain BaseRetrieverï¼Œæ–¹ä¾¿æœªæ¥æ‰©å±•

config/settings.yaml â€” ç®€å•é…ç½®ç¤ºä¾‹

requirements.txt â€” ä¾èµ–åˆ—è¡¨

.env â€” ç¯å¢ƒå˜é‡ç¤ºèŒƒ

README.md â€” ç®€å•è¯´æ˜
```

